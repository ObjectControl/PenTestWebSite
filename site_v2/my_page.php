<?php
    session_start();
    
	include ('db_connect.php');
    $id = $_SESSION['userid'];
    
      $sql = mq("select * from USER where userID='$id'");
      $user = $sql->fetch_array();
    
?>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>
    
    .my_G {
      margin-top: 40px;
    }
    .my_G thead th{
      height:40px;
      border-top:2px solid #09C;
      border-bottom:1px solid #CCC;
      font-weight: bold;
      font-size: 17px;
    }
    
    .my_G tbody td{
      text-align:center;
      padding:10px 0;
      border-bottom:1px solid #CCC; height:20px;
      font-size: 14px
    }
    
    a.unsubscribe {
        text-decoration-line: none;
        color: red;
        font-weight: bold;
    }
    
    a.unsubscribe:hover {
        color : pink;
        text-decoration-line: underline;
        border-bottom: 20px;
    }
    
    a.unsubscribe:visited {
        text-decoration-line: none;
        color: red;
        font-weight: bold;
    }
    
    a.infochange {
        text-decoration-line: none;
        color: blue;
        font-weight: bold;
    }
    
    a.infochange:hover {
        color:blue;
        text-decoration-line: underline;
        border-bottom: 20px;
    }
    
    a.infochange:visited {
        text-decoration-line: none;
        color:blue;
        font-weight: bold;
    }
    
    .list-table {
      margin-top: 40px;
    }
    .list-table thead th{
      height:40px;
      border-top:2px solid #09C;
      border-bottom:1px solid #CCC;
      font-weight: bold;
      font-size: 17px;
    }
    
    .list-table tbody td{
      text-align:center;
      padding:10px 0;
      border-bottom:1px solid #CCC; height:20px;
      font-size: 14px
    }
    
    </style> 
    
        <script type="text/javascript">
            function unsubscribe(){
                var chkpassword = prompt('회원탈퇴를 위하여 비밀번호를 입력해주세요.');
                var userpwd = <? echo $user['password']; ?>;
                
                if(chkpassword == userpwd){
                        window.location.href = "unsubscribe.php?id="+<?php echo $user['userID']; ?>;
                        alert('회원 탈퇴가 완료되었습니다.');
                        window.top.location.replace('logout.php');
                }else if(chkpassword == null) {
                        alert('비밀번호를 입력해주세요.');
                        history.go(-1);
                }else {
                    alert('비밀번호가 잘못되었습니다. 다시 입력해주세요.');
                    history.go(-1);
                }
            }
        </script>
  </head>
  <body>
    <h1>내 정보</h1>
    <table class="my_G">

      <tr>
        <td width="50">아이디</td>
        <td width="100"><?echo $user["userID"];?></td>
        <td width="50">닉네임</td>
        <td width="100"><?echo $user["nickname"];?></td>
        <td width="50">이름</td>
        <td width="100"><? echo $user["name"]; ?></td>
      </tr>
      <tr>
        <td width="150">생년월일</td>
        <td width="150"><? echo $user["birthday"]; ?></td>
        <td width="100">전화번호</td>
        <td width="120"><? echo $user["phone"]; ?></td>
        <td width="50">주소</td>
        <td width="150"><? echo $user["address"]; ?></td>
        <td width="70">이메일</td>
        <td width="170"><? echo $user["email"]; ?></td>
      </tr>
      <tr>
        <?php if($user['userID'] != 'admin'){ ?>
            <td width="200"><a class = "infochange" href = "infochange.php?id=<? echo $user['userID'] ?>">정보수정</a></td>
        <? }; ?>
        
        <?php if($user['userID'] != 'admin'){ ?>
            <td width="200"><a class = "unsubscribe" href = 'javascript:void(0);'  onclick = "unsubscribe()">회원탈퇴</a></td>
        <? }; ?>
      </tr>
    </table>
    <h1>내가 쓴글</h1>
    <table class="list-table">
    <thead>
        <tr>
            <th width="70">번호</th>
              <th width="500">제목</th>
              <th width="100">작성자</th>
              <th width="100">작성일</th>
              <th width="100">조회수</th>
          </tr>
      </thead>
      <?php
      if($id == "admin") {

            // board테이블에서 idx를 기준으로 내림차순해서 5개까지 표시
            $sql = mq("select * from board order by idx desc" );
            while($board = $sql->fetch_array())
            {
                //title변수에 DB에서 가져온 title을 선택
                $title=$board["title"];
                if(strlen($title)>30)
                {
                   //title이 30을 넘어서면 ...표시
                   $title=str_replace($board["title"],mb_substr($board["title"],0,30,"utf-8")."...",$board["title"]);
                }
      ?>
            <tbody>
              <tr>
                <td width="70"><?php echo $board['idx']; ?></td>
                <td width="500"><a href="read.php?board_id=board&idx=<?php echo $board["idx"];?>"><?php echo $title; ?></a></td>
                <td width="100"><?php echo $board['name'] ?></td>
                <td width="100"><?php echo $board['date'] ?></td>
                <td width="100"><?php if($board['hit'] == null) echo 0; else echo $board['hit']; ?></td>
              </tr>
            </tbody>
            <?php } ?>
          
      <?php }else{
                // board테이블에서 idx를 기준으로 내림차순해서 5개까지 표시
                $sql = mq("select * from board where id='$id' order by idx desc" );
                while($board = $sql->fetch_array())
                {
                    //title변수에 DB에서 가져온 title을 선택
                    $title=$board["title"];
                    if(strlen($title)>30)
                    {
                        //title이 30을 넘어서면 ...표시
                        $title=str_replace($board["title"],mb_substr($board["title"],0,30,"utf-8")."...",$board["title"]);
                    }
      ?>
            <tbody>
              <tr>
                <td width="70"><?php echo $board['idx']; ?></td>
                <td width="500"><a href="read.php?board_id=board&idx=<?php echo $board["idx"];?>"><?php echo $title;?></a></td>
                <td width="100"><?php echo $board['name'] ?></td>
                <td width="100"><?php echo $board['date']?></td>
                <td width="100"><?php if($board['hit'] == null) echo 0; else echo $board['hit']; ?></td>
              </tr>
            </tbody>
            <?php } ?>
        
        <?php } ?>

  </table>
  </body>
</html>
